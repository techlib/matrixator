{% extends 'base.html' %}


{% block title %}Změny{% endblock %}

{% block content %}

{% block scripts %}
<script>
    $(document).ready(function () {
        $("#date_from").datepicker({
            todayBtn: "linked",
            format: 'dd-mm-yyyy'
        }).on('changeDate', function (e) {
            emp_table.ajax.url("/changes_data/" + $("#date_from").val() + '/' + $("#date_to").val()).load();
        });
        $("#date_to").datepicker({
            todayBtn: "linked",
            format: 'dd-mm-yyyy'
        }).on('changeDate', function (e) {
            emp_table.ajax.url("/changes_data/" + $("#date_from").val() + '/' + $("#date_to").val()).load();
        });
        emp_table = $('#employees').DataTable({
            dom: 'Bfrtip',
            "ajax": "/changes_data/" + $("#date_from").val() + '/' + $("#date_to").val(),
            "pageLength": 25,
            "order": [[0, "asc"]],
            "columnDefs": {type: 'czech', targets: [1,2]} ,
            "columns": [
                { data: 'oscpv'},
                { data: 'dept' },
                { data: 'name' },
                { data: 'surname' },
                { data: 'occupancy' },
                { data: 'type_of_change' },
                { data: 'date_of_change' },
            ],
            "drawCallback": function () {
                var api = this.api();
                api.rows().every(function (rowIdx, tableLoop, rowLoop) {
                    var init_val = this.data();
                    if (init_val['occupancy'] != 'DPČ/DPP') {
                        init_val['occupancy'] = (init_val['occupancy'] * 1.0).toFixed(2);
                    }
                    this.data(init_val);
                });
            },
            buttons: [
                'excel', 'print'
            ]
        });

        var date = new Date();
        var next_month = new Date(new Date().setMonth(new Date().getMonth() + 1))
        $("#date_from").datepicker('setDate', date);
        $("#date_to").datepicker('setDate', next_month);
        yadcf.init(emp_table, [
            {
                column_number: 0,
                filter_type: 'multi_select',
                select_type: 'select2',
                select_type_options: '',
                style_class: 'form-control',
                reset_button_style_class: 'btn',
                filter_match_mode: 'exact',
            },
            {
                column_number: 1,
                filter_type: 'multi_select',
                select_type: 'select2',
                select_type_options: '',
                style_class: 'form-control',
                reset_button_style_class: 'btn',
                filter_match_mode: 'exact',
            },
            {
                column_number: 2,
                filter_type: 'text',
                style_class: 'form-control',
                reset_button_style_class: 'btn',
            },
            {
                column_number: 3,
                filter_type: 'text',
                style_class: 'form-control',
                reset_button_style_class: 'btn',
            },
            {
                column_number: 4,
                filter_type: 'multi_select',
                select_type: 'select2',
                style_class: 'form-control',
                reset_button_style_class: 'btn',
                filter_match_mode: 'exact',
            },
            {
                column_number: 5,
                filter_type: 'multi_select',
                select_type: 'select2',
                style_class: 'form-control',
                reset_button_style_class: 'btn',
                filter_match_mode: 'exact',
            },
        ]);
    });


</script>
{% endblock %}

<div class='container-fluid'>
    <div class='row buffer-top-md'>
        <div class='col-md-7'>
            <h2>Změny v rozsahu: </h2>
            <form id='dateForm' name='dateForm' class='col-sm-2'>
                <div class='input-daterange input-group' id='datepicker'>
                    <input type='text' class='form-control' name='date_from' id='date_from' readonly='readonly'/>
                    <div class="input-group-addon">do</div>
                    <input type='text' class='form-control' name='date_to' id='date_to' readonly='readonly'/>
                </div>
            </form>
            <div class='table-responsive-xl'>
                <table id='employees' class='display table table-bordered' name='employees'>
                    <thead>
                        <tr>
                            <th>osčpv</th>
                            <th>Oddělení</th>
                            <th>Jméno</th>
                            <th>Příjmení</th>
                            <th>Úvazek</th>
                            <th>Druh změny</th>
                            <th>Datum změny</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>
    </div>
</div>


{% endblock %}